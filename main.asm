TITLE "MAIN"
LIST P=16F1826
#INCLUDE "P16F1826.INC"

__CONFIG _CONFIG1,(_FOSC_INTOSC & _WDTE_OFF & _PWRTE_OFF &_MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _CLKOUTEN_ON & _IESO_OFF & _FCMEN_OFF)

__CONFIG _CONFIG2, (_PLLEN_ON)

UDATA
	FIRST		RES 1
	SECOND		RES 1
ORG 0X0000
	GOTO	START

ORG	0X0004
	GOTO	ISR

ORG 0X0010
	START	
	CLRF	STATUS			
	CLRF	LATA			
	CLRF	LATB		
	BANKSEL	TRISB		
	MOVLW	B'11011111' 
	MOVWF	TRISB
	MOVLW	B'00111100'	
	MOVWF	TRISA
	MOVLW	0xF0		
	MOVWF	OSCCON			
	BANKSEL	ANSELB			
	MOVLW	0X00
	MOVWF	ANSELB
	MOVLW	0X10			
	MOVWF	ANSELA
		
	BANKSEL PIE1			
	BSF		PIE1,6			
	MOVLW	B'11001000'	
	MOVWF	INTCON		
	BANKSEL	IOCBP
	MOVLW	B'00011110'
	MOVWF	IOCBP
	MOVWF	IOCBN
			
	BANKSEL	ADCON0				
	MOVLW	B'00010011'
	MOVWF	ADCON0	
	MOVLW	B'01000000'		
	MOVWF	ADCON1		

LOOP
	GOTO	LOOP

ISR
	BANKSEL ADCON0	
	BTFSS	ADCON0,ADGO
	GOTO	ADC_ISR
	GOTO	QUAD_ISR

ADC_ISR
	BANKSEL	ADRESH
	MOVF	ADRESH,0 	

	BANKSEL	PORTA
	BTFSS	WREG,7		
	BCF 	PORTA,7
	BTFSC	WREG,7
	BSF 	PORTA,7
	
	BANKSEL ADCON0
	BSF		ADCON0,ADGO	

	BANKSEL	INTCON	
	BCF		INTCON,INTF

	RETFIE	

QUAD_ISR
;Loop for 2-3
	BANKSEL	FIRST
	MOVLW	0X00
	MOVWF	FIRST
	MOVWF	SECOND


	BANKSEL	PORTB
	MOVF	PORTB,0
	BANKSEL	FIRST
	BTFSC	WREG,1
	BSF		FIRST,0
	BTFSC	WREG,4
	BSF		FIRST,1

	BANKSEL	PORTB
 	MOVF	PORTB,0
	BANKSEL	SECOND
	BTFSC	WREG,1
	BSF		SECOND,0
	BTFSC	WREG,4
	BSF		SECOND,1

	CALL CHECKER

;Loop for 4-5
	BANKSEL	FIRST
	MOVLW	0X00
	MOVWF	FIRST
	MOVWF	SECOND

	BANKSEL	PORTB
	MOVF	PORTB,0
	BANKSEL	FIRST
	BTFSC	WREG,2
	BSF		FIRST,0
	BTFSC	WREG,3
	BSF		FIRST,1

	BANKSEL	PORTB
 	MOVF	PORTB,0
	BANKSEL	SECOND
	BTFSC	WREG,2
	BSF		SECOND,0
	BTFSC	WREG,3
	BSF		SECOND,1

	CALL CHECKER
	
	GOTO DIM_LIGHT

CHECKER:
	MOVLW	0X00
   	SUBWF 	FIRST,W
	BTFSC 	STATUS,Z
	GOTO	STATE_0

	MOVLW	0X01
   	SUBWF 	FIRST,W
	BTFSC 	STATUS,Z
	GOTO	STATE_1

	MOVLW	0X02
   	SUBWF 	FIRST,W
	BTFSC 	STATUS,Z
	GOTO	STATE_2
	
	MOVLW	0X03
   	SUBWF 	FIRST,W
	BTFSC 	STATUS,Z
	GOTO	STATE_3

	RETURN

STATE_0:
   	MOVF  	SECOND,W
   	SUBLW 	0X03
	BTFSC 	STATUS,Z
	GOTO	FIRE_LIGHT
	RETURN
STATE_1:
   	MOVF  	SECOND,W
   	SUBLW 	0X02
	BTFSC 	STATUS,Z
	GOTO	FIRE_LIGHT
	RETURN
STATE_2:
   	MOVF  	SECOND,W
   	SUBLW 	0X01
	BTFSC 	STATUS,Z
	GOTO	FIRE_LIGHT
	RETURN
STATE_3:
   	MOVF  	SECOND,W
   	SUBLW 	0X00
	BTFSC 	STATUS,Z
	GOTO	FIRE_LIGHT
	RETURN

FIRE_LIGHT
	BANKSEL PORTA
	BSF		PORTA,0
	MOVLW	0X00	

	BANKSEL	INTCON
	BCF		INTCON,INTF
	BCF		INTCON,3

	RETFIE

DIM_LIGHT
	BANKSEL	INTCON
	BCF		INTCON,INTF
	RETFIE

END


