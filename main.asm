TITLE "MAIN"
LIST P=16F1826
#INCLUDE "P16F1826.INC"

__CONFIG _CONFIG1,(_FOSC_INTOSC & _WDTE_OFF & _PWRTE_OFF &_MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _CLKOUTEN_OFF & _IESO_OFF & _FCMEN_OFF)

CBLOCK	0X20
	d1
	d2
	resulthi
	resultlo
ENDC

ORG 0X0000
 	GOTO	START
	NOP

ORG	0X0004
	GOTO	COMPARE_PITCH_TORQUE
	RETFIE

ORG 0X0010
START	
	CLRF	STATUS
	CLRF	LATA
	CLRF	LATB

	BANKSEL	TRISB
	MOVLW	0XC6
	MOVWF	TRISB
	MOVLW	0X3F
	MOVWF	TRISA
	MOVLW	0xF0
	MOVWF	OSCCON

	BANKSEL	ANSELB
	MOVLW	0X00
	MOVWF	ANSELB
	MOVLW	0X10
	MOVWF	ANSELA

	BANKSEL	ADCON1	
	MOVLW	B'01110000'
	MOVWF	ADCON1
	MOVLW	B'00010001' 
	MOVWF	ADCON0 

	BANKSEL	PIR1
	BCF		PIR1,6		;clear adc interrupt flag
	BSF		PIE1,6		;enable adc interrupt
    BSF 	INTCON,6	;enable peripheral interrupt
	BSF		INTCON,7	;enable global interrupt

LOOP
	CALL	SET_ROLL
;	CALL	DO_ADC
;	CALL	COMPARE_PITCH_TORQUE
	CALL	SET_PITCH
	GOTO	LOOP
	NOP

SET_PITCH
	BANKSEL	PORTB
	BTFSS	WREG,0
	BCF		PORTB,3
	NOP
	BTFSC	WREG,0
	BSF		PORTB,3	
	NOP
	RETURN

;DO_ADC
;	BANKSEL	ADCON0 ;
;	MOVLW 	B'00010001' 
;	MOVWF 	ADCON0 
;	CALL	DELAY
;	BSF		ADCON0,ADGO
;	BTFSC	ADCON0,ADGO
;	GOTO	$-1
;	RETURN

COMPARE_PITCH_TORQUE
	BANKSEL	ADRESH
	MOVF	ADRESH,W
	BTFSC	WREG,7
	RETLW	B'00000001'
	NOP
	RETLW	B'00000000'
	NOP

SET_ROLL
	BANKSEL	PORTA
	BTFSS	PORTA,3
	BCF		PORTB,5
	NOP
	BTFSC	PORTA,3
	BSF		PORTB,5	
	NOP
	RETURN

DELAY
	NOP
	NOP
	NOP
	NOP
	RETURN
END  