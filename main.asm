TITLE "MAIN"
LIST P=16F1826
#INCLUDE "P16F1826.INC"

__CONFIG _CONFIG1,(_FOSC_INTOSC & _WDTE_OFF & _PWRTE_OFF &_MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _CLKOUTEN_OFF & _IESO_OFF & _FCMEN_OFF)

CBLOCK	0X20
	d1
ENDC

ORG 0X0000
 	GOTO	START
	NOP
ORG 0x0010
START	
	CLRF	STATUS
	CLRF	LATA
	CLRF	LATB
	MOVLB	1
	MOVLW	B'11000110'
	MOVWF	TRISB
	MOVLW	0X3F
	MOVWF	TRISA
	MOVLW	0xF0
	MOVWF	OSCCON
	MOVLB	3
	MOVLW	0
	MOVWF	ANSELB
	MOVWF	ANSELA
	MOVLB	0
	MOVLW	0X01
	BANKSEL	ADCON1	
	MOVLW	B'11110000'
	MOVWF	ADCON1
	BANKSEL	TRISA
	BSF		TRISA, 4
	BANKSEL	ANSELA
	BSF		ANSELA, 4


LOOP
	CALL	SET_ROLL
	CALL	DO_ADC
	CALL	COMPARE_PITCH_TORQUE
	CALL	SET_PITCH_TORQUE
	GOTO	LOOP
	NOP
DO_ADC
	BANKSEL	ADCON0 ;
	MOVLW 	B'00000001' 
	MOVWF 	ADCON0 		
	CALL 	DELAY
	BSF		ADCON0, ADGO
	BTFSC	ADCON0, ADGO
	GOTO	$-1
	RETURN
COMPARE_PITCH_TORQUE
	BTFSC	ADRESL,7
	RETLW	1
	BTFSC	ADRESL,6
	RETLW	1
	BTFSC	ADRESL,5
	RETLW	1
	BTFSC	ADRESL,4
	RETLW	1
	RETLW	0
SET_ROLL
	BANKSEL PORTA
	BTFSS	PORTA,3
	BCF		PORTB,5
	NOP
	NOP
	NOP
	BTFSC	PORTA,3
	BSF		PORTB,5	
	NOP
	NOP
	NOP
	RETURN
SET_PITCH_TORQUE
	BANKSEL PORTB
	BTFSC	WREG,0
	BSF		PORTB,3
	NOP
	NOP
	NOP	
	BTFSS	WREG,0
	BCF		PORTB,3
	NOP
	NOP
	NOP
	RETURN
DELAY
	MOVLW	0xff
	MOVWF	d1
	DELAY_0
	DECFSZ	d1, f
	GOTO	DELAY_0
	NOP
	RETURN
FINISH
END  