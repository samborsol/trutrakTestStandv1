TITLE "MAIN"
LIST P=16F1826
#INCLUDE "P16F1826.INC"

__CONFIG _CONFIG1,(_FOSC_INTOSC & _WDTE_OFF & _PWRTE_OFF &_MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _CLKOUTEN_OFF & _IESO_OFF & _FCMEN_OFF)

CBLOCK	0X20
	d1
	d2
	resulthi
	resultlo
ENDC

ORG 0X0000
	GOTO	START

ORG	0X0004
	GOTO	ISR

ORG 0X0010
	START	
	CLRF	STATUS
	CLRF	LATA
	CLRF	LATB
	BANKSEL	TRISB
	MOVLW	0XC6
	MOVWF	TRISB
	MOVLW	0X3F
	MOVWF	TRISA
	MOVLW	0xF0
	MOVWF	OSCCON
	BANKSEL	ANSELB
	MOVLW	0X00
	MOVWF	ANSELB
	MOVLW	0X10
	MOVWF	ANSELA

	BANKSEL	PIR1
	BCF	PIR1,6 ;clear adc interrupt flag
	NOP
	BANKSEL PIE1
	BSF	PIE1,6 ;enable adc interrupt
	NOP

	MOVLW	B'11000000'
	MOVWF	INTCON

	BANKSEL	ADCON1	
	MOVLW	B'01110000'
	MOVWF	ADCON1
	MOVLW	B'00010011' 
	MOVWF	ADCON0
	
LOOP
	NOP
	BANKSEL	PORTA
	BTFSS	PORTA,3
	BCF	PORTB,5
	NOP
	BTFSC	PORTA,3
	BSF	PORTB,5	
	NOP
	GOTO	LOOP

ISR
	BCF	INTCON,	GIE ;Disable all interrupts
	NOP
	BANKSEL	ADRESH
	MOVF	ADRESH,W ;copy over voltage reading to WREG

	BANKSEL	PORTB
	BTFSS	WREG,7
	BCF	PORTB,3
 	NOP
	BTFSC	WREG,7
	BSF	PORTB,3	
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP

    	BSF	INTCON,GIE ;re-enable all interrupts
	NOP

	BSF	ADCON0,ADGO
	NOP

	GOTO 	LOOP

END
